<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=0.1' />
	<link rel='stylesheet' href='/style.css'>
</head>

<body>

	<form>
		<input id="videourl"></input>
		<input id="text"></input>
		<input type="submit" id="submit"></input>
	</form>


	<div id="container">
		<div id="header"></div>
		<div id="content"></div>
	</div>

	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>

	<script>
		var socket = io.connect('http://localhost:3000');
		var regexp = /((ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?)/gi;

		socket.on('init', function() {
			socket.emit('get-locations');
		})

		socket.on('set-header', function(city) {
			$('#header').append(`<h1>#nowplaying in ${city}</h1>`);
			$('#header').append(`<p>This page shows #nowplaying tweets in ${city} that constain a youtube link. It also allows you to post a #nowplaying tweet with a YouTube link</p>`);
		});

		socket.on('got-location', function(viewport, location) {
			socket.emit('populate-initial-view', viewport, location)
		})

		socket.on('start-stream', function(viewport) {
			socket.emit('find-tweets', viewport);
		})

		socket.on('render-tweet-initial-view', function (tweet) {
			var text = tweet.text.replace(regexp, '<a href="$1" target="_blank">$1</a>');
			var usr = `<span style='color:#4183C4'>@${tweet.screen_name}</span>`;
			var video = `<iframe width="320" height="240" src="${tweet.video_link}"></iframe>`;
			$('#content').append(video + " : " + text + "<br>");
		});

		socket.on('render-tweet-from-stream', function (tweet) {
			var text = tweet.text.replace(regexp, '<a href="$1" target="_blank">$1</a>');
			var usr = `<span style='color:#4183C4'>@${tweet.screen_name}</span>`;
			var video = `<iframe width="320" height="240" src="${tweet.video_link}"></iframe>`;
			$('#content').prepend(video + " : " + text + "<br>");
		});

		$("form").submit(function(e) {
			e.preventDefault();
			var youtube_link = $('#videourl').val();
			var text = $('#text').val();
			socket.emit('send-tweet', youtube_link, text);
		})

	</script>
</body>
</html>
