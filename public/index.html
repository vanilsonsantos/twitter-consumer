<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=0.1' />
	<link rel='stylesheet' href='/style.css'>
</head>

<body>
	<form>
		<input id="videourl"></input>
		<input id="text"></input>
		<input type="submit" id="submit"></input>
	</form>

	<div id="container"></div>
	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>

	<script>
		var socket = io.connect('http://localhost:3000');
		var regexp = /((ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?)/gi;

		socket.on('init', function() {
			socket.emit('get-locations');
		})

		socket.on('got-location', function(currentLocation, currentCoordinates) {
			socket.emit('populate-initial-view', currentCoordinates, currentLocation)
		})

		socket.on('start-stream', function(currentLocation) {
			socket.emit('find-tweets', currentLocation);
		})

		socket.on('tweet', function (data) {
			var text = data.text.replace(regexp, '<a href="$1" target="_blank">$1</a>');
			var usr = `<span style='color:#4183C4'>@${data.screen_name}</span>`;
			var video = `<iframe width="320" height="240" src="${data.video_link}"></iframe>`;
			$('#container').prepend(video + " : " + text + "<br>");
		});

		$("form").submit(function(e) {
			e.preventDefault();
			var youtube_link = $('#videourl').val();
			var text = $('#text').val();
			socket.emit('send-tweet', youtube_link, text);
		})

	</script>
</body>
</html>
